create table users(
	id int(20) unsigned not null primary key auto_increment,
	username varchar(20) not null,
	password varchar(200) not null default '123456',
	password_salt varchar(100),
	deleted bit not null default 0
);

create table user (
  id bigint auto_increment,
  username varchar(100),
  password varchar(100),
  salt varchar(100),
  role_ids varchar(100),
  locked bool default false,
  constraint pk_user primary key(id)
) charset=utf8 ENGINE=InnoDB;
create unique index idx_user_username on user(username);

create table resource (
  id bigint auto_increment,
  name varchar(100),
  type varchar(50),
  url varchar(200),
  parent_id bigint,
  parent_ids varchar(100),
  permission varchar(100),
  available bool default false,
  constraint pk_resource primary key(id)
) charset=utf8 ENGINE=InnoDB;
create index idx_resource_parent_id on resource(parent_id);
create index idx_resource_parent_ids on resource(parent_ids);

create table role (
  id bigint auto_increment,
  role varchar(100),
  description varchar(100),
  resource_ids varchar(100),
  available bool default false,
  constraint pk_role primary key(id)
) charset=utf8 ENGINE=InnoDB;
create index idx_role_resource_ids on role(resource_ids);

insert into role values(1, 'admin', '超级管理员', '11', true);
insert into role values(2, 'staff', '宿舍管理员', '', true);
insert into role values(3, 'consellor', '辅导员', '', true);
insert into role values(4, 'student', '学生', '', true);
insert into user values(1,'admin','d3c59d25033dbf980d29554025c23a75','8d78869f470951332959580424d4bf4f', '1', false);
insert into resource values(11, '用户管理', 'menu', '/user', 1, '0/1/', 'user:*', true);
insert into resource values(12, '用户新增', 'button', '', 11, '0/1/11/', 'user:create', true);
insert into resource values(13, '用户修改', 'button', '', 11, '0/1/11/', 'user:update', true);
insert into resource values(14, '用户删除', 'button', '', 11, '0/1/11/', 'user:delete', true);
insert into resource values(15, '用户查看', 'button', '', 11, '0/1/11/', 'user:view', true);

create table college(
	collegeID int(4) unsigned not null primary key,
	collegeName varchar(11) not null,
	deleted bit not null default 0
);

create table speYears(
	speYearsID int(2) unsigned not null primary key,
	speYearsName varchar(11) not null,
	speYearsLength int(1) not null,
	deleted bit not null default 0
);

create table speciality(
	speciID int(5) unsigned not null primary key,
	speciName varchar(11) not null,
	collegeID int(4) unsigned not null,
	speYearsID int(2) unsigned not null,
	deleted bit not null default 0,
	foreign key(collegeID) references college(collegeID),
	foreign key(speYearsID) references speYears(speYearsID)
);

create table consellor(
	consellID int(20) unsigned not null primary key,
	consellName varchar(20) not null,
	consellSex int(1),
	consellTel varchar(11),
	deleted bit not null default 0
);

create table staff(
	staffID int(20) unsigned not null primary key,
	staffName varchar(11) not null,
	staffSex int(1),
	staffTel varchar(11),
	hiredate datetime not null default current_timestamp,
	leavedate datetime default null,
	deleted bit not null default 0
);

create table class(
	classID int(6) unsigned not null primary key,
	className varchar(11) not null,
	speciID int(5) unsigned not null,
	consellID int(20) unsigned,
	deleted bit not null default 0,
	foreign key(speciID) references speciality(speciID),
	foreign key(consellID) references consellor(consellID)
);

create table student(
	stdID int(20) unsigned not null primary key,
	stdName varchar(11) not null,
	stdSex int(1),
	stdTel varchar(11),
	enterTime date,
	isParty bit,
	classID int(6) unsigned,
	deleted bit not null default 0,
	foreign key(classID) references class(classID)
);

create table apartment(
	apartID int(3) unsigned not null primary key,
	apartName varchar(11) not null,
	apartNum int(2) not null,
	staffID int(20) unsigned,
	deleted bit not null default 0,
	foreign key(staffID) references staff(staffID)
);

create table apartStaffRelation(	
	relationID int(20) unsigned not null primary key auto_increment,
	apartID int(3) unsigned not null,
	staffID int(20) unsigned not null,
	create datetime not null default current_timestamp,
	leave datetime default null,
	deleted bit not null default 0,
	foreign key(apartID) references apartment(apartID),
	foreign key(staffID) references staff(staffID)
);

create table floor(
	floorID int(11) unsigned not null primary key,
	apartID int(3) unsigned not null,
	floorNo int(2) not null,
	deleted bit not null default 0,
	foreign key(apartID) references apartment(apartID)
);

create table floorLeaderRelation(
	relationID int(20) unsigned not null primary key auto_increment,
	floorID int(2) unsigned not null,
	stdID int(20) unsigned not null,
	create datetime not null default current_timestamp,
	leave datetime default null,
	deleted bit not null default 0,
	foreign key(floorID) references floor(floorID),
	foreign key(stdID) references student(stdID)
);

create table dormitory(
	dormID int(11) unsigned not null primary key,
	dormNo int(2) not null,
	floorID int(11) unsigned not null,
	fee decimal(6,2) not null,
	stdID int(20) foreign key references student(stdID),
	deleted bit not null default 0,
	foreign key(floorID) references floor(floorID)
);

create table bed(
	bedID int(11) unsigned not null primary key,
	dormID int(11) unsigned not null,
	deleted bit not null default 0,
	foreign key(dormID) references dormitory(dormID)
);

create table activityRoom(
	actRoomID int(11) unsigned not null primary key,
	actRoomNo int(2) not null,
	floorID int(11) unsigned not null,
	deleted bit not null default 0,
	foreign key(floorID) references floor(floorID)
);